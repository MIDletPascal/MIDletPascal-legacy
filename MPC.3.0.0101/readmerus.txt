Модифицированный компилятор MidletPascal.  v3.0.0101

1. переписан лексический анализатор: "sources\lex\lex.yy.c" 

2. запись строк через: 'text'#13#10'text'#9#13#10'text' 

3. команды: shr shl

4. Поправлена длина массивов=32767, (MP макс. длина была 16000)

5. inline вставки кода:
asm-код записывается через ";" на любую длину, может состоять из байта или опкода.
опкод может иметь параметры, которые проверяются для данной команды (число / ссылка_на_константный_пул_с_указанием_типа_записи)
указание_типа_записи: int / utf8 / str / class / nametype / field / method
проверка параметров опкода производиться на:
1 байтовый эл-т
2-х байтовый эл-т
4-х байтовый эл-т
1 байт - индекс конст.пула
2 байт - индекс конст.пула
тип записи конст.пула
параметры типа константного пула

6. Убрана запятая из конструкция "if then ; else ;"  в  "if then  else ;"

7. Возможно применение сразу обоих типов Real fixed / Real float в одном исходном файле (на свой страх и риск, т.к. нельзя допускать в одном выражении сразу два вида этих переменных, а также своевременно переключать компилятор на работу для каждого вида).

8. Наличие текста после "end." выдает только предупреждение, а не ошибку.

9. В парсере исправлены потенциально - возможные зацикливания кода при ошибках




Пример
var
  myint : integer;

procedure memclean;
begin
  inline(invokestatic  method  'java/lang/System', 'gc', '()V');
end;

begin
  //myint:=10;
  inline(  //inline demo1
    16; $10;
    putstatic		field	'M','myint','I'
  ) ;
  //myint:=getWidth;
    inline(
    getstatic	field	'M', 'I', 'Ljavax/microedition/lcdui/Image;';		//rem1
    invokevirtual	method	'javax/microedition/lcdui/Image', 'getWidth', '()I';		{rem2}
    putstatic	field	'M','myint','I'					(*rem3*)
  );
  memclean;
end.

6. Добавлены директивы компиляции:
	{$R-} - fixed point (задействован по умолчанию)
	{$R+} - float point
	{$T-} - отключить lowcase текста исходника
	{$T+} - включить  lowcase текста исходника (задействован по умолчанию)

режимы lowcase - необходимы для создания и доступа к переменным, которые содержат буквы верхнего регистра.
(например создание модуля в паскале с именем "Lib_....class")


=================
Компиляция:
1. Запустить "run.bat"
2. После успешной компиляции все появившиеся "*.class" файлы упаковать в архив "NewProject.jar.zip"
3. Переименовываем "NewProject.jar.zip" в файл "NewProject.jar"
4. Если в программе используется "fixed-point", то в архиве переименовать какой-либо из файлов  "F.big.class", "F.small.class" в файл "F.class"
5. Запускаем получившийся мидлет

Неполадки:
* Если при компиляции программа вылетает с ошибкой, то это из-за операций выделения памяти.
Чтобы устранить неполадку необходимо на файле MPC.EXE: правой кнопкой мыши - свойства - совместимость - запустить программу в режиме совместимости с Windows 95

* Если в исходнике встречаются русские строки, необходимо сохранять его в кодировке Utf-8.

* MPC не создает дерево компиляции модулей, поэтому порядок компиляции вы устанавливаете сами: первыми компилируйте обособленные модули, не использующие ни какие из этого проекта; затем компилируйте те, которые используют эти, и т.д... в завершении компилируется основная программа.



arT(c). 2009-2010
e-mail: IronWoodcutter@bk.ru
